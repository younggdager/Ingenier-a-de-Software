<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proveedores - Sistema de Gesti√≥n</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="dashboard-layout">
        <aside class="sidebar" id="sidebar"></aside>
        <main class="main-content">
            <div class="page-header">
                <h1>üè≠ Proveedores</h1>
                <p>Gesti√≥n de proveedores</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>Lista de Proveedores</h3>
                    <button class="btn btn-primary" onclick="nuevoProveedor()">+ Nuevo Proveedor</button>
                </div>
                <div class="card-body" id="proveedoresTable">Cargando...</div>
            </div>
        </main>
    </div>

    <div id="modalProveedor" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h2>Nuevo Proveedor</h2>
                <button class="modal-close" onclick="cerrarModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="proveedorForm">
                    <div class="form-group">
                        <label>Nombre *</label>
                        <input type="text" id="nombre" required>
                    </div>
                    <div class="form-group">
                        <label>Contacto</label>
                        <input type="text" id="contacto">
                    </div>
                    <div class="form-group">
                        <label>Tel√©fono *</label>
                        <input type="tel" id="telefono" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="email">
                    </div>
                    <div class="form-group">
                        <label>Tipo de Productos *</label>
                        <input type="text" id="tipoProductos" required>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline" onclick="cerrarModal()">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="/js/auth.js"></script>
    <script src="/js/sidebar.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            if (!Auth.requireAuth()) return;
            await cargarProveedores();
            document.getElementById('proveedorForm').addEventListener('submit', guardarProveedor);
        });
        
        async function cargarProveedores() {
            try {
                const data = await API.get('/proveedores');
                const proveedores = data.proveedores || [];
                
                const container = document.getElementById('proveedoresTable');
                if (proveedores.length === 0) {
                    container.innerHTML = '<p class="text-center">No hay proveedores</p>';
                    return;
                }
                
                container.innerHTML = `
                    <table>
                        <thead>
                            <tr><th>Nombre</th><th>Contacto</th><th>Tel√©fono</th><th>Tipo Productos</th></tr>
                        </thead>
                        <tbody>
                            ${proveedores.map(p => `
                                <tr>
                                    <td><strong>${p.nombre}</strong></td>
                                    <td>${p.contacto || 'N/A'}</td>
                                    <td>${p.telefono}</td>
                                    <td>${p.tipoProductos}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (error) {
                Utils.showError(error);
            }
        }
        
        function nuevoProveedor() {
            document.getElementById('proveedorForm').reset();
            document.getElementById('modalProveedor').style.display = 'flex';
        }
        
        function cerrarModal() {
            document.getElementById('modalProveedor').style.display = 'none';
        }
        
        async function guardarProveedor(e) {
            e.preventDefault();
            
            const data = {
                nombre: document.getElementById('nombre').value,
                contacto: document.getElementById('contacto').value,
                telefono: document.getElementById('telefono').value,
                email: document.getElementById('email').value,
                tipoProductos: document.getElementById('tipoProductos').value
            };
            
            try {
                await API.post('/proveedores', data);
                Utils.showAlert('Proveedor creado exitosamente');
                cerrarModal();
                await cargarProveedores();
            } catch (error) {
                Utils.showError(error);
            }
        }
    </script>
</body>
</html>
